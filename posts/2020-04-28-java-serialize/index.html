<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.62.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>对象序列化 &middot; qinry&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://qinry.github.io"><h1>qinry&#39;s blog</h1></a>
      <p class="lead">
       在此写下学习日志，努力充电中～ 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://github.com/qinry"> Github </a></li>
      </ul>
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>对象序列化</h1>
  <time datetime=2020-04-28T16:01:24&#43;0800 class="post-date">Tue, Apr 28, 2020</time>
  <h2 id="heading">持久性</h2>
<p>如果对象能够在程序不运行还能保存其状态信息。可以通过将信息写入文件或数据库来达到程序下次执行时，对象重建后与上次拥有一致的信息。在Java中一切都是对象的思想下，把对象声明为“持久性”，可以省去一些细节，对程序员是种方便。对象的序列化，可以理解为把对象导入到文件中，通过<code>Serialize</code>接口实现。通过导入文件能够反序列化还原对象，达到持久性的目的。该特性支持计算机的远程方法调用，还有帮助Java Bean在设计阶段保存配置信息，并在启动程序后恢复配置信息。如果要把一个对象序列化，实现<code>Serialize</code>接口就可以了，此接口只是标记接口，不含方法。</p>
<h2 id="heading-1">序列化写入文件</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: io/StoreCADState.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Saving the state of a pretend CAD system.
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>

<span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Shape</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> RED <span style="color:#f92672">=</span> 1<span style="color:#f92672">,</span> BLUE <span style="color:#f92672">=</span> 2<span style="color:#f92672">,</span> GREEN <span style="color:#f92672">=</span> 3<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> xPos<span style="color:#f92672">,</span> yPos<span style="color:#f92672">,</span> dimension<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Random rand <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">(</span>47<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> counter <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> newColor<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getColor</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Shape</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> xVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> yVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> dim<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        xPos <span style="color:#f92672">=</span> xVal<span style="color:#f92672">;</span>
        yPos <span style="color:#f92672">=</span> yVal<span style="color:#f92672">;</span>
        dimension <span style="color:#f92672">=</span> dim<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> getClass<span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;color[&#34;</span> <span style="color:#f92672">+</span> getColor<span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] xPos[&#34;</span> <span style="color:#f92672">+</span> xPos <span style="color:#f92672">+</span>
        <span style="color:#e6db74">&#34;] yPos[&#34;</span> <span style="color:#f92672">+</span> yPos <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] dim[&#34;</span> <span style="color:#f92672">+</span> dimension <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]\n&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Shape <span style="color:#a6e22e">randomFactory</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> xVal <span style="color:#f92672">=</span> rand<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>100<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">int</span> yVal <span style="color:#f92672">=</span> rand<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>100<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">int</span> dim <span style="color:#f92672">=</span> rand<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>100<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">switch</span><span style="color:#f92672">(</span>counter<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">%</span> 3<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
        <span style="color:#66d9ef">case</span> 0<span style="color:#f92672">:</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Circle<span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">case</span> 1<span style="color:#f92672">:</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Square<span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">case</span> 2<span style="color:#f92672">:</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Line<span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Circle</span> <span style="color:#66d9ef">extends</span> Shape <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> color <span style="color:#f92672">=</span> RED<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Circle</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> xVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> yVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> dim<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> newColor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> color <span style="color:#f92672">=</span> newColor<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getColor</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> color<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Square</span> <span style="color:#66d9ef">extends</span> Shape <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> color<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Square</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> xVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> yVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> dim<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        color <span style="color:#f92672">=</span> RED<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> newColor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> color <span style="color:#f92672">=</span> newColor<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getColor</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> color<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Line</span> <span style="color:#66d9ef">extends</span> Shape <span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> color <span style="color:#f92672">=</span> RED<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">serializeStaticState</span><span style="color:#f92672">(</span>ObjectOutputStream os<span style="color:#f92672">)</span>
<span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span> os<span style="color:#f92672">.</span><span style="color:#a6e22e">writeInt</span><span style="color:#f92672">(</span>color<span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span>
<span style="color:#a6e22e">deserializeStaticState</span><span style="color:#f92672">(</span>ObjectInputStream os<span style="color:#f92672">)</span>
<span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span> color <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span><span style="color:#a6e22e">readInt</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Line</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> xVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> yVal<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> dim<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>xVal<span style="color:#f92672">,</span> yVal<span style="color:#f92672">,</span> dim<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> newColor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> color <span style="color:#f92672">=</span> newColor<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getColor</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> color<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StoreCADState</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;</span><span style="color:#f92672">?</span> <span style="color:#66d9ef">extends</span> Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span> shapeTypes <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;</span><span style="color:#f92672">?</span> <span style="color:#66d9ef">extends</span> Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Add references to the class objects:
</span><span style="color:#75715e"></span>        shapeTypes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Circle<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        shapeTypes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Square<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        shapeTypes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Line<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        List<span style="color:#f92672">&lt;</span>Shape<span style="color:#f92672">&gt;</span> shapes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Make some shapes:
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span>
        shapes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Shape<span style="color:#f92672">.</span><span style="color:#a6e22e">randomFactory</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Set all the static colors to GREEN:
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">(</span><span style="color:#f92672">(</span>Shape<span style="color:#f92672">)</span>shapes<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span>Shape<span style="color:#f92672">.</span><span style="color:#a6e22e">GREEN</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Save the state vector:
</span><span style="color:#75715e"></span>        ObjectOutputStream out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectOutputStream<span style="color:#f92672">(</span>
        <span style="color:#66d9ef">new</span> FileOutputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CADState.out&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        out<span style="color:#f92672">.</span><span style="color:#a6e22e">writeObject</span><span style="color:#f92672">(</span>shapeTypes<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        Line<span style="color:#f92672">.</span><span style="color:#a6e22e">serializeStaticState</span><span style="color:#f92672">(</span>out<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        out<span style="color:#f92672">.</span><span style="color:#a6e22e">writeObject</span><span style="color:#f92672">(</span>shapes<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Display the shapes:
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>shapes<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ObjectOutputStream的<code>writeObject(Object)</code>该方法先检查传入的Serialize对象是否实现了<code>private writeObject(ObjectOutputStream) throws IOException</code>方法(可以在其内部调用OjbectOutputStream的<code>defaultWriteObject()</code>)有会自动调用，接着序列化到ObjectOutputStream关联的文件上,如果要序列化保存<code>static</code>域，要自己手动创建一个方法来实现操作，如上的serializeStaticState()方法,还要注意维护对象写入序列化文件的顺序。在有部分不需要序列化的域标记为<code>transient</code>即可,它要在构造器初始化;想全部不需要所有的域可以实现<code>Externalizable</code>(继承了Serialize，没有transient那么的灵活控制不想序列化的域)，必须实现<code>writeExternal(ObjectOutput) throws IOException</code>和<code>readExternal(ObjectInput) throws IOException, ClassNotFoundException</code>这两个方法。</p>
<p>Output:</p>
<pre><code>[class Circlecolor[3] xPos[58] yPos[55] dim[93]
, class Squarecolor[3] xPos[61] yPos[61] dim[29]
, class Linecolor[3] xPos[68] yPos[0] dim[22]
, class Circlecolor[3] xPos[7] yPos[88] dim[28]
, class Squarecolor[3] xPos[51] yPos[89] dim[9]
, class Linecolor[3] xPos[78] yPos[98] dim[61]
, class Circlecolor[3] xPos[20] yPos[58] dim[16]
, class Squarecolor[3] xPos[40] yPos[11] dim[22]
, class Linecolor[3] xPos[4] yPos[83] dim[6]
, class Circlecolor[3] xPos[75] yPos[10] dim[42]
]
</code></pre>
<h2 id="heading-2">读取文件反序列化</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: io/RecoverCADState.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Restoring the state of the pretend CAD system.
</span><span style="color:#75715e"></span><span style="color:#75715e">// {RunFirst: StoreCADState}
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RecoverCADState</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        ObjectInputStream in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectInputStream<span style="color:#f92672">(</span>
        <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CADState.out&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// Read in the same order they were written:
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;</span><span style="color:#f92672">?</span> <span style="color:#66d9ef">extends</span> Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span> shapeTypes <span style="color:#f92672">=</span>
        <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;</span><span style="color:#f92672">?</span> <span style="color:#66d9ef">extends</span> Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">)</span>in<span style="color:#f92672">.</span><span style="color:#a6e22e">readObject</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        Line<span style="color:#f92672">.</span><span style="color:#a6e22e">deserializeStaticState</span><span style="color:#f92672">(</span>in<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        List<span style="color:#f92672">&lt;</span>Shape<span style="color:#f92672">&gt;</span> shapes <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Shape<span style="color:#f92672">&gt;</span><span style="color:#f92672">)</span>in<span style="color:#f92672">.</span><span style="color:#a6e22e">readObject</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>shapes<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Output:</p>
<pre><code>[class Circlecolor[1] xPos[58] yPos[55] dim[93]
, class Squarecolor[0] xPos[61] yPos[61] dim[29]
, class Linecolor[3] xPos[68] yPos[0] dim[22]
, class Circlecolor[1] xPos[7] yPos[88] dim[28]
, class Squarecolor[0] xPos[51] yPos[89] dim[9]
, class Linecolor[3] xPos[78] yPos[98] dim[61]
, class Circlecolor[1] xPos[20] yPos[58] dim[16]
, class Squarecolor[0] xPos[40] yPos[11] dim[22]
, class Linecolor[3] xPos[4] yPos[83] dim[6]
, class Circlecolor[1] xPos[75] yPos[10] dim[42]
]
</code></pre>
<p>ObjectInputStream的<code>readObject()</code>会检查恢复的Serialize对象是否实现<code>private readObject() throws IOException, ClassNotFoundException</code>，有则自动调用, 接着返回要恢复的对象，根据序列化的顺序一样的次序，反序列化，注意类型的转换，<code>static</code>域的恢复也是要手动实现。</p>

</div>


    </main>

    
  </body>
</html>
