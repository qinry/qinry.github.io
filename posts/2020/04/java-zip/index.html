<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.85.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Java压缩文件的IO流 &middot; 欢迎来到槎城小子的博客！</title>
  <meta name="description" content="Java编程思想读书笔记——压缩和解压文件的IO" />

  
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/copy-code-button.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/toc.css">
  <link type="text/css" rel="stylesheet" href="https://qinry.github.io/css/backtop.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../../apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="../../../../favicon.png">

  
  <link href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.1.0/styles/base16/monokai.min.css" rel="stylesheet">

<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.1.0/highlight.min.js"></script>

<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script src="../../../../js/copy-code-button.js"></script>
<script src="../../../../js/main.js"></script>


</head>

  <body class="theme-base-0d ">
    <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://qinry.github.io/"><h1>欢迎来到槎城小子的博客！</h1></a>
      <p class="lead">
       不积硅步无以至千里，不积小流无以成江海。 
      </p>
    </div>
    
    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://qinry.github.io/">Home</a> </li>
        <li><a href="https://github.com/qinry"> Github </a></li><li><a href="../../../../tags"> 分类标签 </a></li>
      </ul>
    </nav>

    <p>Copyright © 2021 槎城小子</p>
  </div>
</aside>

    

    <main class="content container">
    <div class="post">

  <h1>Java压缩文件的IO流</h1>
  <span class="post-date">
    2020-04-28 14:50 &nbsp;
    字数：<strong>1010</strong> &nbsp;
    标签：
              <a href="https://qinry.github.io/tags/%E7%AC%94%E8%AE%B0/">笔记</a>&nbsp;
  </span>

  <p>Java I/O库提供压缩功能输入、输出流，这些类是按字节方式处理，常用的压缩类有DeflaterOutputStream和它的子类ZipOutputStream、GZIPOutputStream、CheckedOutputStream，这些是用于压缩的，相应地，有解压的的InflaterInputStream和它的子类ZipInputStrea、GZIPInputStream、CheckedInputStream。</p>
<h2 id="对单个数据流进行压缩">对单个数据流进行压缩</h2>
<p>GZIP接口简单，一般用于单个数据流的压缩,用例如下:</p>
<pre><code>import java.util.zip.*; // 导入压缩格式的数据流类
import java.io.*;

public class GZIPcompress {
    public static void main(String[] args)
    throws IOException {
        if(args.length == 0) {
            System.out.println(
            &quot;Usage: \nGZIPcompress file\n&quot; +
            &quot;\tUses GZIP compression to compress &quot; +
            &quot;the file to test.gz&quot;);
            System.exit(1);
        }
        // 读取要压缩的文件数据
        BufferedReader in = new BufferedReader(
        new FileReader(args[0]));
        // 创建压缩文件
        BufferedOutputStream out = new BufferedOutputStream(
            new GZIPOutputStream(
                new FileOutputStream(&quot;test.gz&quot;)));

        System.out.println(&quot;Writing file&quot;);
        int c;
        while((c = in.read()) != -1)
            out.write(c);
        in.close();
        out.close();

        System.out.println(&quot;Reading file&quot;);
        BufferedReader in2 = new BufferedReader(
            new InputStreamReader(new GZIPInputStream(
                new FileInputStream(&quot;test.gz&quot;))));
        String s;
        while((s = in2.readLine()) != null)
        System.out.println(s);
    }
}
</code></pre><p>GZIP*putStream的构造器的参数是File*putStream，还可用Buffered*putStream包装。GZIPOutputStream的构造器只能接受OutputStream对象，不接受Writer对象。打开文件时,GZIPInputStream会转换为Reader。</p>
<h2 id="多文件压缩保存">多文件压缩保存</h2>
<p>Java压缩库使用标准的zip格式，用Checksum类进行计算和校验文件的校验和(Adler32和CRC32两种格式，前者速度快，后者慢但准确)。用例如下：</p>
<pre><code>import java.util.zip.*;
import java.io.*;
import java.util.*;
public class ZipCompress {
    public static void main(String[] args) {
        // 压缩:
        //1 创建压缩输出流，输出流套四层 T_T
        FileOutputStream f = new FileOutputStream(&quot;test.zip&quot;);
        CheckedOutputStream csum =
            new CheckedOutputStream(f, new Adler32())
        ZipOutputStream zos = new ZipOutputStream(csum);
        BufferedOutputStream out =
            new BufferedOutputStream(zos);
        // 为文件设置注释
        zos.setComment(&quot;测试Java压缩文件&quot;);

        int ch;
        BufferedReader in = new BufferedReader(new FileReader(&quot;a.txt&quot;));
        //2 压缩条目添加到压缩输出流
        zos.putNextEntry(new ZipEntry(&quot;a.txt&quot;));
        //3 往缓冲输出流写入压缩文件数据
        while((ch = in.read()) != -1) {
            out.write(ch);
        }
        in.close();
        out.flush(); // 注意读完一个文件刷新缓冲区

        //4 重复2，3步骤，添加第二个文件，如果压缩更多文件采用循环
        in = new BufferedReader(new FileReader(&quot;b.txt&quot;));
        //2 压缩条目添加到压缩输出流
        zos.putNextEntry(new ZipEntry(&quot;b.txt&quot;));
        //3 往缓冲输出流写入压缩文件数据
        while((ch = in.read()) != -1) {
            out.write(ch);
        }
        in.close();
        out.flush();
        out.close();

        // 读取压缩文件
        //1 创建解压缩输入流，又套四层 T_T
        FileInputStream fi = new FileInputStream(&quot;test.zip&quot;);
        CheckedInputStream csumi =
            new CheckedInputStream(f, new Adler32())
        ZipInputStream zi = new ZipInputStream(csum);
        BufferedInputStream bis =
            new BufferedInputStream(zos);

        ZipEntry ze;
        while((ze = zi.getNextEntry()) != null) {
            System.out.println(&quot;File: &quot; + ze);
            while((ch = bis.read()) != -1)
                System.out.write(ch);
        }
        bis.close();
        /* 另一种读取压缩文件
        ZipFile zf = new ZipFile(&quot;test.zip&quot;);
        Enumeration e = zf.entries();
        while(e.hasMoreElement()) {
            ZipEntry ze2 = (ZipEntry)e.nextElement();
            System.out.println(&quot;File: &quot; + ze2);
            while((ch = bis.read()) != -1)
                System.out.write(ch);
        }
        */
    }
}
</code></pre><h2 id="jar工具打包和解压">jar工具打包和解压</h2>
<p>jar常用命令:</p>
<p>类文件简单打包</p>
<p><code>% jar cf myJar.jar *.class</code></p>
<p>类文件，用户自建清单文件打包</p>
<p><code>% jar cfm myJar.jar *.class MANIFEST.MF *.class</code></p>
<p>多目录打包</p>
<p><code>% jar cf myApp.jar audio classes image</code></p>
<p>jar文件解压</p>
<p><code>% jar xf myApp.jar</code></p>

</div>


    </main>
    <button class="backtop-btn">
<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-circle-up" class="svg-inline--fa fa-chevron-circle-up fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path fill="currentColor" d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm231-113.9L103.5 277.6c-9.4 9.4-9.4 24.6 0 33.9l17 17c9.4 9.4 24.6 9.4 33.9 0L256 226.9l101.6 101.6c9.4 9.4 24.6 9.4 33.9 0l17-17c9.4-9.4 9.4-24.6 0-33.9L273 142.1c-9.4-9.4-24.6-9.4-34 0z">
    </path>
</svg>
</button>
    
      
    
  </body>
</html>
