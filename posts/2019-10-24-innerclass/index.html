<!doctype html>
<html lang="en-us">

<head>
  <title>《Thinking in Java》 -- 内部类 // qinry&#39;s blog</title>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.60.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="qinry" />
  <meta name="description"
    content="" />
  <link rel="stylesheet" href="https://qinry.github.io/css/main.min.f90f5edd436ec7b74ad05479a05705770306911f721193e7845948fb07fe1335.css" />

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《Thinking in Java》 -- 内部类"/>
<meta name="twitter:description" content="内部类 创建内部类 直接将内部类置于外围类中
// innerclasses/Parcel1.java // Creating inner classes public class Parcel1 { class Contents { private int i = 11; public int value() { return i; } } class Destination { private String label; Destination(String whereTo) { label = whereTo; } String readLabel() { return label; } } // Using inner classes looks just like 	// using any other class, within Parcel1; 	public void ship(String dest) { Contents c = new Contents(); Destination d = new Destination(dest); System."/>

  <meta property="og:title" content="《Thinking in Java》 -- 内部类" />
<meta property="og:description" content="内部类 创建内部类 直接将内部类置于外围类中
// innerclasses/Parcel1.java // Creating inner classes public class Parcel1 { class Contents { private int i = 11; public int value() { return i; } } class Destination { private String label; Destination(String whereTo) { label = whereTo; } String readLabel() { return label; } } // Using inner classes looks just like 	// using any other class, within Parcel1; 	public void ship(String dest) { Contents c = new Contents(); Destination d = new Destination(dest); System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://qinry.github.io/posts/2019-10-24-innerclass/" />
<meta property="article:published_time" content="2019-10-24T16:48:18+08:00" />
<meta property="article:modified_time" content="2019-10-24T16:48:18+08:00" />


</head>

<body>
  <header class="app-header">
    <a href="https://qinry.github.io"><img class="app-header-avatar"
        src="/avatar.jpg"
        alt="qinry" /></a>
    <h1>qinry&#39;s blog</h1>
    <p>
      在此写下学习日志，努力充电中～
    </p>
    <div class="app-header-social">
      
      <a target="_blank" href="https://github.com/qinry"
        rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
      
    </div>
  </header>
  <main class="app-container">
    
<article class="post">
  <header class="post-header">
    <h1 class="post-title">《Thinking in Java》 -- 内部类</h1>
    <div class="post-meta">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
        Oct 24, 2019
      </div>
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
        4 min read
      </div><div>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
        <a class="tag" href="https://qinry.github.io/tags/java/">java</a></div></div>
  </header>
  <div class="post-content">
    <h1 id="heading">内部类</h1>
<h2 id="heading1">创建内部类</h2>
<p>直接将内部类置于外围类中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// innerclasses/Parcel1.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Creating inner classes
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Parcel1</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Contents</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 11<span style="color:#f92672">;</span>
		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Destination</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">private</span> String label<span style="color:#f92672">;</span>

		Destination<span style="color:#f92672">(</span>String whereTo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			label <span style="color:#f92672">=</span> whereTo<span style="color:#f92672">;</span>
		<span style="color:#f92672">}</span>

		String <span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> label<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
	<span style="color:#75715e">// Using inner classes looks just like
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// using any other class, within Parcel1;
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ship</span><span style="color:#f92672">(</span>String dest<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Contents c <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Contents<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		Destination d <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Destination<span style="color:#f92672">(</span>dest<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>d<span style="color:#f92672">.</span><span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Parcel1 p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Parcel1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		p<span style="color:#f92672">.</span><span style="color:#a6e22e">ship</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tasmania&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#75715e">/* Output: 
</span><span style="color:#75715e">Tasmania
</span><span style="color:#75715e">*/</span><span style="color:#75715e">//:~
</span></code></pre></div><p>如果想从外部类的非静态方法之外的任意位置创建内部类的对象，那么不像在 <strong>main</strong>方法中那样，具体地指明这个对象的类型：OuterClassName.InnerClassName。</p>
<h1 id="heading2">链接到外部类</h1>
<p>内部类除了时名字隐藏和组织代码的模式，它还与制造它的外围类发生联系，能访问其外围对象的所有成员，无需任何特殊条件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: innerclasses/Parcel2.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Returning a reference to an inner class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Parcel2</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Contents</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 11<span style="color:#f92672">;</span>

		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Destination</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">private</span> String label<span style="color:#f92672">;</span>

		Destination<span style="color:#f92672">(</span>String whereTo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			label <span style="color:#f92672">=</span> whereTo<span style="color:#f92672">;</span>
		<span style="color:#f92672">}</span>

		String <span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> label<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> Destination <span style="color:#a6e22e">to</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Destination<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> Contents <span style="color:#a6e22e">contents</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Contents<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ship</span><span style="color:#f92672">(</span>String dest<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Contents c <span style="color:#f92672">=</span>  contents<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		Destination d <span style="color:#f92672">=</span> to<span style="color:#f92672">(</span>dest<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>d<span style="color:#f92672">.</span><span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Parcel2 p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Parcel2<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		p<span style="color:#f92672">.</span><span style="color:#a6e22e">ship</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tasmaina&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		Parcel2 q <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Parcel2<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		<span style="color:#75715e">// Defining references to inner classes:
</span><span style="color:#75715e"></span>		Parcel2<span style="color:#f92672">.</span><span style="color:#a6e22e">Contents</span> c <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span><span style="color:#a6e22e">contents</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		Parcel2<span style="color:#f92672">.</span><span style="color:#a6e22e">Destination</span> d <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span><span style="color:#a6e22e">to</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Borneo&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>这是个迭代器设计模式。内部类用到了<strong>items</strong>，它并不是内部类的部分，是外围类的private字段，说明了内部类可以访问外部类的成员。</p>
<p>当某个外围类创建了一个内部类对象，此内部类对象必定秘密捕获一个指向外围类的引用。然后，在你访问此外围类的成员时，就是通过那个引用来选择外围类成员。一般编译器会处理捕获引用的细节，而且内部对象只能在与其外围类的对象发生相关联的情况下才能被创建（内部类有使用外围类成员就会发生关联）。内部类是非static类。</p>
<h2 id="this--new">使用.this 与 .new</h2>
<p>如果内部类需要生成对外部类对象的引用，可以<strong>OuterClassName.this</strong>像这样，产生的引用会在编译器自动确定正确类型，没有运行时开销。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: innerclasses/DotThis.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Accessing the outer-class object
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DotThis</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">f</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;DotThis.f()&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Inner</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">public</span> DotThis <span style="color:#a6e22e">outer</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">return</span> DotThis<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">;</span>
			<span style="color:#75715e">// A plain &#34;this&#34; would be Inner&#39;s &#34;this&#34;
</span><span style="color:#75715e"></span>		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> Inner <span style="color:#a6e22e">inner</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Inner<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		DotThis dt <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DotThis<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		DotThis<span style="color:#f92672">.</span><span style="color:#a6e22e">Inner</span> dti <span style="color:#f92672">=</span> dt<span style="color:#f92672">.</span><span style="color:#a6e22e">inner</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		dti<span style="color:#f92672">.</span><span style="color:#a6e22e">outer</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">f</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>如果可能创建某个对象的内部类对象，要在new表达式中提供外部类对象的引用, 像<strong>OuterObject.new</strong>的表达式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: innerclasses/DotNew.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Creating an inner class directly using .new syntax
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DotNew</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Inner</span> <span style="color:#f92672">{</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		DotNew dn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DotNew<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		DotNew<span style="color:#f92672">.</span><span style="color:#a6e22e">Inner</span> dni <span style="color:#f92672">=</span> dn<span style="color:#f92672">.</span><span style="color:#a6e22e">new</span> <span style="color:#a6e22e">Inner</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> 
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="heading3">内部类向上转型</h2>
<p>内部类向上转型为其基类，尤其是转型为一个接口，会有大用途。这是因为内部类可以设定为private（或protected），能够对外部（或包外除继承子类）不可见且不可用，得到的只是指向基类或接口的引用，所以通过这种方式可以完全组织任何依赖于类型的编码，很方便地实现隐藏实现细节。只有内部类可以设为private和protected。</p>
<h2 id="heading4">在方法和作用域的内部类</h2>
<p>在方法中或任意的作用域中定义内部类，有两个原因：</p>
<p>1.实现某个类型的接口，可以创建并返回对其的引用</p>
<p>2.要解决一个复杂问题，借用一个类辅助，但又不希望此类是公共可用的</p>
<h3 id="heading5">局部内部类</h3>
<p>在方法和作用域中，需要已命名的构造器或重载构造器，使用局部内部类，相比匿名类，可以使用多个该类对象。</p>
<h3 id="heading6">匿名内部类</h3>
<p>把对象生成和类型定义结合在一起，用在方法的返回值中, 只能实例初始化，如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> interfaces Destination <span style="color:#f92672">{</span>
    String <span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Parcel9</span> <span style="color:#f92672">{</span>
	<span style="color:#75715e">// Argument must be final or &#34;effectively final&#34;
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// to use within the anonymous inner class:
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> Destination <span style="color:#a6e22e">destination</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String dest<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Destination<span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">private</span> String label <span style="color:#f92672">=</span> dest<span style="color:#f92672">;</span>
			<span style="color:#a6e22e">@Override</span> 
			<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">readLabel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> label<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		Parcel9 p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Parcel9<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		Destination d <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">destination</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tasmania&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		<span style="color:#75715e">//System.out.println(d.readLabel());
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>如果定义一个匿名内部类，并且希望它使用一个在其外部定义的对象，那么编译器会要求其参数引用是final。想做一些类似构造器的行为，但匿名类没有命名的构造器，可以用实例初始化来达到构造器的行为。</p>
<h3 id="heading7">再访工厂方法</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: innerclasses/Factories.java
</span><span style="color:#75715e"></span><span style="color:#f92672">import static</span> net.mindview.util.Print.*<span style="color:#f92672">;</span>

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Service</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ServiceFactory</span> <span style="color:#f92672">{</span>
    Service <span style="color:#a6e22e">getService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Implementation1</span> <span style="color:#66d9ef">implements</span> Service <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">Implementation1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Implementation1.method1&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Implementation1.method2&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ServiceFactory factory <span style="color:#f92672">=</span> 
        <span style="color:#66d9ef">new</span> ServiceFactory<span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> Service <span style="color:#a6e22e">getService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Implementation1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Implementation2</span> <span style="color:#66d9ef">implements</span> Service <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">Implementation2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Implementation2.method1&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">method2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Implemetation2.method2&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ServiceFactory factory <span style="color:#f92672">=</span>
        <span style="color:#66d9ef">new</span> ServiceFactory<span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> Service <span style="color:#a6e22e">getService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Implementation2<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Factories</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">serviceConsumer</span><span style="color:#f92672">(</span>ServiceFactory fact<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Service s <span style="color:#f92672">=</span> fact<span style="color:#f92672">.</span><span style="color:#a6e22e">getService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        s<span style="color:#f92672">.</span><span style="color:#a6e22e">method1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        s<span style="color:#f92672">.</span><span style="color:#a6e22e">method2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        serviceConsumer<span style="color:#f92672">(</span>Implementation1<span style="color:#f92672">.</span><span style="color:#a6e22e">factory</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        serviceConsumer<span style="color:#f92672">(</span>Implementation2<span style="color:#f92672">.</span><span style="color:#a6e22e">factory</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><strong>Implementation1</strong> 和 <strong>Implementation2</strong>的构造器是private的，并且没有任何要去创建作为工厂的具名类。另外，你经常只需要单一的工厂对象，因此在本例中它被创建为Service实现中的一个static域。</p>
<h3 id="heading8">嵌套类</h3>
<p>将内部类声明为static，通称为嵌套类。意味着要创建嵌套类的对象，并不需要其外围类的对象；不能从嵌套类的对象中访问非静态的外围类对象。也就说嵌套类是与外部类没有联系的内部类。它和内部类的区别在于，普通内部类的字段和方法不能是static，也不能包含嵌套类，而嵌套类可以包含这些。</p>
<h4 id="heading9">接口内部的类</h4>
<p>如果想创建某些 <em>公共代码</em> ，使得它可以被某个接口的所有不同实现所共用，那么在接口内部嵌套类会显得方便。接口中的类自动地是public 和 static的，因为类是static的，只是将嵌套类置于接口的命名空间内，并不会违反接口的规则。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ClassInInterface</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">howdy</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span> implememnts ClassInInterface <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">howdy</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Howdy!&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">new</span> Test<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">howdy</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>一般建议为每个类写一个<strong>main</strong>函数，用来测试这个类，这样做有个缺点，必须带着那些已编译过的额外代码。如果这对你很麻烦，可以使用嵌套类来放置测试代码，在不需要的时候，删掉嵌套类文件。</p>
<p>一个内部类被嵌套多少层，都能够透明地访问到所有它所嵌入的外围类的所有成员。</p>
<h2 id="heading10">为什么需要内部类</h2>
<p>可以认为内部类提供某种进入其外围类的窗口。还可以是多继承的解决方案变得完整，
如果拥有的是抽象的类或具体的类，而不是接口，只能使用内部类实现多继承。</p>
<h2 id="heading11">继承内部类</h2>
<p>继承内部类的构造器必须连接到指向基类的外围类的引用，还要在构造器内调用基类的构造器
，编译才能通过。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//: innerclasses/InheritInner.java
</span><span style="color:#75715e"></span><span style="color:#75715e">// Inheriting an inner class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WithInner</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Inner</span> <span style="color:#f92672">{</span><span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InheritInner</span> <span style="color:#66d9ef">extends</span> WithInner<span style="color:#f92672">.</span><span style="color:#a6e22e">Inner</span> <span style="color:#f92672">{</span>
	<span style="color:#75715e">//- InheritInner() {} // Won&#39;t compile
</span><span style="color:#75715e"></span>	InheritInner<span style="color:#f92672">(</span>WithInner wi<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		wi<span style="color:#f92672">.</span><span style="color:#a6e22e">super</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> 
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		WithInner wi <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> WithInner<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
		InheritInner ii <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InheritInner<span style="color:#f92672">(</span>wi<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="heading12">内部类可以覆盖吗</h2>
<p>当继承了某个外围类时，内部类并没有发生什么神奇的变化,两个内部类时完全独立的两个实体。</p>
<h2 id="heading13">内部类标识符</h2>
<p>类文件命名规则其实是外围类名字加上$，再加上内部类的名字;
如果内部类是匿名类，编译器简单地产生一个数字作为标识符；
如果内部类是嵌套在别的内部类之中，只需直接将它们的名字放在其外围类标识符与$的后面
例如：</p>
<pre><code>Counter.class, 
LocalInnerClass$1.class, // 匿名类标识符：用一个数字表示，文件命名：外围类名字+$+数字
LocalInner$1LocalCounter.class, // 
LocalInnerClass.class
</code></pre>
  </div>
  <div class="post-footer">
    
  </div>
</article>

  </main>
</body>

</html>
